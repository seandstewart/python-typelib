name: setup-environ
description: Setup the CI environ with Poetry & Pre-Commit Caching

inputs:
  python-version:
    description: The Python version to build your environment with.
  runner:
    description: The Runner to build your environment on.
  release-app-id:
    description: The App ID used to manage releases.
  release-private-key:
    description: The private key used to authenticate the release bot app.

runs:
  using: composite
  steps:
  - uses: actions/create-github-app-token@v1
    id: app-token
    with:
      app-id: ${{ inputs.release-app-id }}
      private-key: ${{ inputs.release-app-private-key }}
  - uses: actions/checkout@v4
    with:
      token: ${{ steps.app-token.outputs.token }}
  - uses: actions/setup-python@v5
    with:
      python-version: ${{ inputs.python-version }}
  - uses: Gr1N/setup-poetry@v8
  - uses: actions/cache@v4
    with:
      path: ~/.cache/
      key: ${{ inputs.runner }}|${{ inputs.python-version }}|${{ hashFiles('poetry.lock') }}|${{ hashFiles('.pre-commit-config.yaml') }}
  - run: poetry --version
    shell: bash
  - run: make install
    shell: bash
  - run: poetry env info
    shell: bash
